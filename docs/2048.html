<html>
 <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>2048 - jsGames</title>
  <style>
@import url(https://fonts.googleapis.com/css?family=Special+Elite);
body>div.hidden {	visibility:hidden;				}
body {			background-color: #d5edf7;			}
html, body {		margin:0; padding:0; overflow:hidden;		}
div#game {		height:100%;					}
div#game>svg {		position:fixed; top:0; bottom:0; left:0; right:0}

div#game>svg text {
	-webkit-user-select: none;
	-moz-user-select: none;
	-ms-user-select: none;
	user-select: none;
}
  </style>
 </head>
 <body>
  <div class="hidden" id="svg">
  </div>
  <div id="game"></div>
  <script>
(function(global,factory){factory(global)})(this,function(global){var find,elem=function(d){var e=function(){if(this.hasOwnProperty("constructor")&&typeof this["constructor"]==="function"){return this["constructor"].call(e)}else if(typeof this==="function"){return this.call(e)}console.log("elem.e, hum shouldnt be here");return e};e.node=d;e.add=function(type,before){var n,b=null;switch(type){case"use":case"svg":case"line":case"defs":case"clipPath":case"g":case"rect":case"text":case"path":case"mask":n=global.document.createElementNS("http://www.w3.org/2000/svg",type);if(type=="svg"){n.setAttribute("height","100%");n.setAttribute("width","100%");n.setAttribute("xmlns","http://www.w3.org/2000/svg");n.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink");var d=global.document.createElementNS("http://www.w3.org/2000/svg","defs");n.insertBefore(d,null)}break;default:n=global.document.createElement(type);break}switch(typeof before){case"object":b=before;break;case"string":b=e.node.querySelector(before);break;case"function":if(typeof before["node"]==="object")b=before.node;break}e.node.insertBefore(n,b);return elem(n)};e.html=function(c){if(typeof c==="string")e.node.innerHTML=c;else return e.node.innerHTML;return e};e.find=find;e.clone=function(el){var ne=el.node.cloneNode(true);ne.removeAttribute("id");e.node.appendChild(ne);return elem(ne)};e.remove=function(){e.node.remove();return e};e.attr=function(name,value){if(arguments.length>1&&value===null){e.node.removeAttribute(name)}else if(arguments.length>1&&name.startsWith("xlink")){e.node.setAttributeNS("http://www.w3.org/1999/xlink",name,value)}else if(arguments.length>1){e.node.setAttribute(name,value)}else if(arguments.length==1){return e.node.getAttribute(name)}return e};switch(e.node.nodeName){case"line":case"g":case"rect":case"text":case"use":case"path":var scale={x:1,y:1};var pos={x:0,y:0};var angle=0;var transform=function(){e.attr("transform","translate("+pos.x+" "+pos.y+") scale("+scale.x+" "+scale.y+") rotate("+angle+")")};e.pos=pos;e.moveTo=function(x,y){pos.x=x;pos.y=y;transform();return e};e.moveBy=function(x,y){pos.x+=x;pos.y+=y;transform();return e};e.scale=function(x,y){scale.x=x;scale.y=y;transform();return e};e.rotate=function(a){angle=a;transform();return e};e.fromClientCoordinates=function(x,y){var svg=e.node;var ctm=e.node.getScreenCTM();while(typeof svg.parentNode["getCTM"]==="function"){svg=svg.parentNode}var point=svg.createSVGPoint();point.x=x;point.y=y;return point.matrixTransform(ctm.inverse())};break}return e};find=function(sel){var f=function(){console.log("find.f called",this,arguments);return f};f.nodes=[];var p=function(a){f.nodes.push(elem(a))};f.find=find;if(this===global)global.document.querySelectorAll(sel).forEach(p);else if(typeof this["each"]==="function")this.each(function(e){e.node.querySelectorAll(sel).forEach(p)});else if(typeof this["node"]==="object")this.node.querySelectorAll(sel).forEach(p);f.each=function(){f.nodes.forEach(...arguments)};f.lead=f.nodes[0];f.add=function(){var args=arguments;f.each(function(e){e.add(...args)});return find.call(this,sel+" "+args[0])};f.attr=function(){var args=arguments;f.each(function(e){e.attr(...args)});return f};return f};global.doc=elem(global.document)});this.game={version:"0.1.0",widgets:{},status:{cash:10},format:{number:function(x){var e=x.toExponential();if(e.indexOf("e")>0){var exp=parseInt(e.substr(e.indexOf("e+")+2));var val=x/10**exp;if(exp<8)return""+Math.round(x*1e3)/1e3;return""+Math.round(val*1e3)/1e3+" 10^"+exp}else return""+Math.round(x*1e3)/1e3}}};(function(global,factory){factory(global.game,global.game.sprites=global.game.sprites||[],global.doc,global)})(this,function(game,sprites,doc,global){var sheet=function(e){var sheet=e;sheet.get=function(sp){return sheet.find("g#".concat(sp)).lead};return sheet};var sprite=function(e,sh,sp){var sprite=e;sprite.setup=function(){doc.find("div#game svg>defs").each(function(e){if(e.find("#"+sh+"-"+sp).nodes.length>0)return;e.clone(sprite).attr("id",sh+"-"+sp).attr("transform","translate("+-sprite.box.x+" "+-sprite.box.y+")")})};sprite.constructor=function(){var g=this.add("g");var set=function(s){s.setup();g.sprite=s;g.obj=g.add("use").attr("xlink:href","#"+sh+"-"+sp)};g.scaleTo=function(x,y){g.scale(x/g.sprite.box.width,y/g.sprite.box.height);return g};g.swap=function(spr){g.obj.remove();set(spr);return g};g.father=this;set(sprite);return g};sprite.sheet_id=sh;sprite.sheet=sprites.sheets[sh];sprite.sprite_id=sp;sprite.box=sprite.node.getBBox();return sprite};sprites.sheets=[];doc.find("body>div.hidden#svg div.svg").each(function(e){sprites.sheets[e.node.id]=sheet(e);e.find("g").each(function(sp){if(sp.node.id!=""){sprites[e.node.id.concat("-",sp.node.id)]=sprite(sp,e.node.id,sp.node.id)}})})});(function(global,factory){factory(global.game,global.doc,global)})(this,function(game,doc,global){var defaultColor="#fff";var defaultFamily="Arial,sans-serif";var defaultSize=30;var defaultSpacing=1.2;game.text=function(str){var size=defaultSize;var family=defaultFamily;var color=defaultColor;var spacing=defaultSpacing;var lineCount=0;var cons=function(){var g=this.add("g").attr("font-size",size).attr("font-family",family).attr("fill",color);g.getNewLine=function(str){return g.add("text").html(str).attr("y",lineCount++*spacing*size)};g.addLine=function(str){g.getNewLine(str);return g};g.reset=function(){lineCount=0;g.node.textContent="";return g};g.size=function(_size){size=_size;g.attr("font-size",size);return g};g.spacing=function(_size){spacing=_size;return g};g.family=function(_family){family=_family;g.attr("font-family",family);return g};g.color=function(_color){color=_color;g.attr("fill",color);return g};g.setText=function(_text){g.find("text").lead.html(_text);return g};g.addLine(str);return g};cons.size=function(_size){size=_size;return cons};cons.spacing=function(_size){spacing=_size;return cons};cons.family=function(_family){family=_family;return cons};cons.color=function(_color){color=_color;return cons};return cons};game.text.setDefaultSize=function(size){defaultSize=size};game.text.setDefaultFamily=function(family){defaultFamily=family};game.text.setDefaultColor=function(color){defaultColor=color};game.text.setDefaultSpacing=function(spacing){defaultSpacing=spacing}});(function(global,factory){factory(global.game,global)})(this,function(game,global){var requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;var anims=[];var longCalls=[];var stopped=true;var anim=function(elem,cb){var a=function(){console.log("anim.a CALLED",cb,elem,arguments,this)};a.run=function(ts){cb.call(elem,a,ts)};a.start=null;return a};game.anim={};game.anim.add=function(elem,cb){var a=anim(elem,cb);anims.push(a);return a};game.anim.addLong=function(cb){longCalls.push(cb);return game.anim};game.anim.empty=function(){anims=[]};game.anim.count=function(){return anims.length};game.anim.del=function(a){var i=anims.indexOf(a);if(i>=0)anims.splice(i,1)};var tickLen=40;game.anim.getTickLen=function(){return tickLen};game.anim.stop=function(){stopped=true};game.anim.start=function(){stopped=false;requestAnimationFrame(step)};var beginTick=null;var beginPause=null;var prevTick=0;var prevLong=null;var step=function(timestamp){if(beginTick==null)beginTick=timestamp;if(beginPause!=null){beginTick+=timestamp-beginPause;beginPause=null}if(prevLong==null||prevLong+1e4<timestamp){prevLong=timestamp;longCalls.forEach(function(l){l()})}var tick=Math.trunc((timestamp-beginTick)/tickLen);if(tick>prevTick)anims.forEach(function(a){a.run(tick)});prevTick=tick;if(!stopped)setTimeout(function(){requestAnimationFrame(step)},beginTick+(tick+1)*tickLen-timestamp);else beginPause=timestamp};requestAnimationFrame(step)});(function(global,factory){factory(global.game,global.game.anim,global.doc,global)})(this,function(game,anim,doc,global){var screens=[];game.screens={};game.screens.current=null;game.screens.add=function(name,cb){screens.push({name:name,cb:cb,data:{}});return game.screens};game.screens.play=function(name){var scr=null;screens.forEach(function(s){if(s.name==name)scr=s});if(scr!=null){anim.stop();anim.empty();doc.find("div#game").lead.html("");for(var i=0;i<localStorage.length;i++){var k=localStorage.key(i);var v=localStorage.getItem(k);var key=scr.data;var prevK=key;var prevJ="";var a=k.split(".");if(a[0]==scr.name){for(var j=1;j<a.length;j++){prevK=key;key[a[j]]=key[a[j]]||{};key=key[a[j]],prevJ=j}prevK[a[prevJ]]=v}}game.screens.current=scr.cb.call(doc.find("div#game").lead,scr);anim.start()}return game.screens};anim.addLong(function(){if(game.screens.current!=null){var d=game.screens.current.data;var stack=[];var root=game.screens.current.name;Object.keys(d).forEach(function(k){var v=d[k];if(typeof v=="object")stack.push({root:root+"."+k,value:v})});while(stack.length>0){var e=stack.pop();Object.keys(e.value).forEach(function(k){var v=e.value[k];if(typeof v=="object")stack.push({root:e.root+"."+k,value:v});else localStorage.setItem(e.root+"."+k,v)})}}})});(function(global,factory){factory(global.game,global.game.widgets,global.game.sprites,global.game.anim,global.doc,global)})(this,function(game,widgets,sprites,anim,doc,global){var clickableDefaultShift=0;var clickableDefaultPadding=12;widgets.clickable=function(_up,_down,_dis,cb){var up=_up,down=_down,dis=_dis,shift=clickableDefaultShift;return function(){var ret=this.add("g");var g=ret.add("g");var s=g.call(up);var icon=null;var text=null;var isUp=true;var disabled=false;var iconPos=null;var textPos=null;ret.setTextPos=function(p){textPos=p;return ret};var posText=function(){if(textPos==null){var tb=text.node.getBBox();var h=tb.height;var w=tb.width;var y=h/2+clickableDefaultPadding;var x=1.5*clickableDefaultPadding;if(h+2*clickableDefaultPadding<s.node.getBBox().height)y+=s.node.getBBox().height-h-2*clickableDefaultPadding;if(icon!=null)x+=icon.node.getBBox().width+clickableDefaultPadding;if(x+w+clickableDefaultPadding*1.5<s.node.getBBox().width)x=s.node.getBBox().width/2-w;text.moveTo(x,y)}else text.moveTo(textPos.x,textPos.y)};ret.setIconPos=function(p){iconPos=p;return ret};ret.setIcon=function(i){if(icon!=null)icon.remove();icon=g.call(i);if(iconPos==null){var b_h=s.node.getBBox().height;var i_h=icon.node.getBBox().height;var sca=(b_h-2*clickableDefaultPadding-2)/i_h;icon.scale(sca,sca).moveTo(clickableDefaultPadding,clickableDefaultPadding)}else icon.scaleTo(iconPos.width,iconPos.height).moveTo(iconPos.x,iconPos.y);if(text!=null)posText();return ret};ret.setText=function(t){if(text!=null)text.setText(t);else{text=g.call(t);posText()}return ret};ret.text=function(){return text};ret.disable=function(b){disabled=true;if(arguments.length>0&&!b)disabled=false;if(disabled)s.swap(dis);else s.swap(up);return ret};ret.setShift=function(_shift){shift=_shift};ret.setUp=function(_up){up=_up;if(isUp)s.swap(up)};ret.setDown=function(_down){down=_down;if(!isUp)s.swap(down)};ret.setDisabled=function(_dis){dis=_dis;if(disabled)s.swap(dis)};ret.node.onmousedown=function(){if(!disabled){s.swap(down);isUp=false;g.moveTo(0,shift)}};ret.node.onmouseout=function(){if(!disabled){s.swap(up);isUp=true;g.moveTo(0,0)}};ret.node.onmouseup=function(){if(!disabled){s.swap(up);isUp=true;g.moveTo(0,0);cb.call(ret)}};return ret}};var hboxCnt=0;widgets.hbox3=function(l,m,r,w){return function(){var ret=this.add("g");var id=hboxCnt++;var sl=ret.call(sprites[l]);var sm=ret.call(sprites[m]);var sr=ret.call(sprites[r]);var pct=100;var width;doc.find("div#game svg>defs").each(function(e){e.add("clipPath").attr("id","hbox-"+id).add("rect").attr("x",0).attr("y",0).attr("width",w).attr("height",sm.sprite.box.height)});var clip=doc.find("div#game svg>defs clipPath#hbox-"+id+" rect");ret.attr("clip-path","url(#hbox-"+id+")");ret.setPct=function(p){pct=p;clip.attr("width",pct*width/100)};ret.setWidth=function(w){width=w;ret.setPct(pct);sr.moveTo(width-sr.sprite.box.width,0);sm.moveTo(sl.sprite.box.width-1,0).scaleTo(width-sr.sprite.box.width-sl.sprite.box.width+1,sm.sprite.box.height)};ret.swap=function(l,m,r){sl.swap(sprites[l]);sm.swap(sprites[m]);sr.swap(sprites[r]);ret.setWidth(width)};ret.setWidth(w);return ret}};widgets.vbox3=function(t,m,b,h){return function(){}};var scrollableCnt=0;widgets.scrollable=function(bgw,w,h,topClip=0){var id=scrollableCnt++;var isVert=false,isHorz=false;var cons=function(){var root=this;doc.find("div#game svg>defs").each(function(e){e.add("clipPath").attr("id","scroll-"+id).add("rect").attr("x",0).attr("y",topClip).attr("width",w).attr("height",h-topClip)});var bg=this.call(bgw);var outter=bg.add("g").attr("clip-path","url(#scroll-"+id+")");var inner=outter.add("g");var started=null;bg.inner=function(){return inner};var mouseMove=function(e){var deltaX=e.x-started.x;var deltaY=e.y-started.y;var bb=inner.node.getBBox();if(!isHorz)deltaX=0;if(!isVert)deltaY=0;if(deltaX!=0){if(inner.pos.x+deltaX<w-bb.width)deltaX=w-bb.width-inner.pos.x;if(inner.pos.x+deltaX>0)deltaX=-inner.pos.x}if(deltaY!=0){if(inner.pos.y+deltaY<h-bb.height)deltaY=h-bb.height-inner.pos.y;if(inner.pos.y+deltaY>0)deltaY=-inner.pos.y}inner.moveBy(deltaX,deltaY)};bg.node.onmousedown=function(e){started=e};bg.node.onmouseout=function(e){if(started==null)return false;var m=bg.fromClientCoordinates(e.clientX,e.clientY);if(m.x>0&&m.y>0&&m.x<w&&m.y<h)return false;started=null};bg.node.onmouseup=function(e){if(started==null)return true;mouseMove(e);started=null};bg.node.onmousemove=function(e){if(started==null)return true;mouseMove(e);started=e};return bg};cons.isVert=function(_){if(_){isVert=_;return cons}return isVert};cons.isHorz=function(_){if(_){isHorz=_;return cons}return isHorz};return cons};var box9Cnt=0;widgets.box9=function(s,c,w,h,mar=0){var id=box9Cnt++;var bb=sprites[s].box;var width;var height;var cid=c+"-"+Math.trunc(bb.width)+"-"+Math.trunc(bb.height);var pid=s+"-"+c;doc.find("div#game svg>defs").each(function(e){sprites[s].setup();function makeClip(id,x,y,w,h){if(e.find("#"+id).nodes.length>0)return;e.add("clipPath").attr("id",id).add("rect").attr("x",x).attr("y",y).attr("width",w).attr("height",h)}makeClip("clip-box9-"+cid+"-tl",0,0,c+1,c+1);makeClip("clip-box9-"+cid+"-t",c,0,bb.width-2*c+1,c+1);makeClip("clip-box9-"+cid+"-tr",bb.width-c,0,c+1,c+1);makeClip("clip-box9-"+cid+"-l",0,c,c+1,bb.height-2*c+1);makeClip("clip-box9-"+cid+"-c",c,c,bb.width-2*c+1,bb.height-2*c+1);makeClip("clip-box9-"+cid+"-r",bb.width-c,c,c+1,bb.height-2*c+1);makeClip("clip-box9-"+cid+"-bl",0,bb.height-c,c+1,c);makeClip("clip-box9-"+cid+"-b",c,bb.height-c,bb.width-2*c+1,c);makeClip("clip-box9-"+cid+"-br",bb.width-c,bb.height-c,c,c);function makeUse(dir,x=0,y=0){if(e.find("#box9-"+pid+"-"+dir).nodes.length>0)return;var r=e.add("use").attr("xlink:href","#"+s).attr("clip-path","url(#clip-box9-"+cid+"-"+dir+")").attr("id","box9-"+pid+"-"+dir);if(x!=0||y!=0)r.moveTo(x,y)}makeUse("tl");makeUse("t",-c,0);makeUse("tr",c-bb.width,0);makeUse("br",c-bb.width,c-bb.height);makeUse("b",-c,c-bb.height);makeUse("bl",0,c-bb.height);makeUse("r",c-bb.width,-c);makeUse("c",-c,-c);makeUse("l",0,-c)});var cons=function(){var ret=this.add("g");var tl=ret.add("use").attr("xlink:href","#box9-"+pid+"-tl");var t=ret.add("use").attr("xlink:href","#box9-"+pid+"-t");var tr=ret.add("use").attr("xlink:href","#box9-"+pid+"-tr");var l=ret.add("use").attr("xlink:href","#box9-"+pid+"-l");var m=ret.add("use").attr("xlink:href","#box9-"+pid+"-c");var r=ret.add("use").attr("xlink:href","#box9-"+pid+"-r");var bl=ret.add("use").attr("xlink:href","#box9-"+pid+"-bl");var b=ret.add("use").attr("xlink:href","#box9-"+pid+"-b");var br=ret.add("use").attr("xlink:href","#box9-"+pid+"-br");var apply=function(b9,w,h){t.scale((w-2*c)/(b9.bb.width-2*c+1),1).moveTo(c,0);tr.moveTo(w-c-mar,0);l.scale(1,(h-2*c)/(b9.bb.height-2*c+1)).moveTo(0,c);m.scale((w-2*c)/(b9.bb.width-2*c+1),(h-2*c)/(b9.bb.height-2*c+1)).moveTo(c,c);r.scale(1,(h-2*c)/(b9.bb.height-2*c+1)).moveTo(w-c-mar,c);bl.moveTo(0,h-c-mar);b.scale((w-2*c)/(b9.bb.width-2*c+1),1).moveTo(c,h-c-mar);br.moveTo(w-c-mar,h-c-mar)};ret.setSize=function(w,h){width=w;height=h;apply(cons,width,height)};ret.swap=function(b9){tl.attr("xlink:href","#box9-"+b9.pid+"-tl");t.attr("xlink:href","#box9-"+b9.pid+"-t");tr.attr("xlink:href","#box9-"+b9.pid+"-tr");l.attr("xlink:href","#box9-"+b9.pid+"-l");m.attr("xlink:href","#box9-"+b9.pid+"-c");r.attr("xlink:href","#box9-"+b9.pid+"-r");bl.attr("xlink:href","#box9-"+b9.pid+"-bl");b.attr("xlink:href","#box9-"+b9.pid+"-b");br.attr("xlink:href","#box9-"+b9.pid+"-br");apply(b9,width,height);return ret};ret.setSize(w,h);return ret};cons.id=id;cons.pid=pid;cons.bb=bb;return cons}});(function(global,factory){factory(global.game,global.game.widgets,global.game.sprites,global.game.anim,global.doc,global)})(this,function(game,widgets,sprites,anim,doc,global){var margin=8;var aLength=5;var colors=["#7cb342","#8bc34a","#9ccc65","#aed581","#cddc39","#dce775","#fff176","#ffeb3b","#fdd835","#fbc02d","#ff8f00","#ff6f00"];widgets.cell=function(grid,_x,_y,_v=2,r=8){var x=-1,y,val;var dim=grid.getCellSize();return function(){var c=this.add("g");var re=c.add("rect").attr("width",dim.width).attr("height",dim.height).attr("rx",r).attr("ry",r).attr("stroke","#AAA").attr("stroke-width",margin);var t=c.call(game.text(""+val).size(dim.height/2)).moveTo(dim.width/2-dim.height/6,dim.height*2/3);c.value=function(_){if(arguments.length<1)return val;val=_;var col=colors[11];switch(val){case 2:col=colors[0];break;case 4:col=colors[1];break;case 8:col=colors[2];break;case 16:col=colors[3];break;case 32:col=colors[4];break;case 64:col=colors[5];break;case 128:col=colors[6];break;case 256:col=colors[7];break;case 512:col=colors[8];break;case 1024:col=colors[9];break;case 2048:col=colors[10];break}re.attr("fill",col);t.setText(""+val);if(val>10&&val<100)t.moveTo(dim.width/2-dim.height/3,dim.height*2/3);else if(val>100&&val<1e3)t.moveTo(dim.width/15,dim.height*2/3);else if(val>1e3&&val<1e4)t.size(dim.height/3).moveTo(dim.width/10,dim.height*16/27);else if(val>1e4)t.size(dim.height/4).moveTo(dim.width/8,dim.height*7/12);return c};var setPos=function(_x,_y){x=_x;y=_y;var pos=grid.getCellPos(x,y);c.moveTo(pos.x,pos.y)};c.pos=function(_x,_y,cb){if(arguments.length<2)return{x:x,y:y};if(x!=-1){var startTick=-1;var startPos=grid.getCellPos(x,y);var endPos=grid.getCellPos(_x,_y);var stepX=(endPos.x-startPos.x)/aLength;var stepY=(endPos.y-startPos.y)/aLength;var a=anim.add(c,function(e,tick){if(startTick==-1)startTick=tick;var delta=tick-startTick;if(delta>aLength){setPos(_x,_y);anim.del(a)}else c.moveTo(startPos.x+delta*stepX,startPos.y+delta*stepY)})}else setPos(_x,_y);return c};c.merge=function(other){other.pos(x,y);var startTick=-1;var a=anim.add(c,function(e,tick){if(startTick==-1)startTick=tick;if(tick-startTick>=aLength){c.value(val+other.value());other.node.remove();anim.del(a)}});return c};c.value(_v);c.pos(_x,_y);return c}}});(function(global,factory){factory(global.game,global.game.widgets,global.game.sprites,global.game.anim,global.doc,global)})(this,function(game,widgets,sprites,anim,doc,global){var height=1080;var width=height;var leftMargin=1920-width;var margin=8;var aLength=5;var rand=function(m){return Math.floor(Math.random()*Math.floor(m))};var rect=function(col,w,h,r=8){return function(){return this.add("rect").attr("width",w).attr("height",h).attr("rx",r).attr("ry",r).attr("fill",col)}};widgets.grid=function(wc=4,hc=4,col1="#555",col2="#AAA"){var h=(height-margin)/hc-margin;var w=(width-margin)/wc-margin;var a=[];for(var x=0;x<wc;x++){var t=[];for(var y=0;y<hc;y++){t[y]=null}a[x]=t}var cons=function(){var root=this;var g=this.add("g").moveTo(leftMargin,0);g.call(rect(col1,width,height));for(var x=0;x<wc;x++)for(var y=0;y<hc;y++)g.call(rect(col2,w,h)).moveTo(margin+x*(w+margin),margin+y*(h+margin));g.getCellSize=function(){return{width:w,height:h}};g.getCellPos=function(x,y){var a=margin+x*(w+margin)+leftMargin;var b=margin+y*(h+margin);return{x:a,y:b}};g.isFull=function(){for(var x=0;x<wc;x++)for(var y=0;y<hc;y++)if(a[x][y]==null)return true;return false};g.addCell=function(){var x=rand(wc);var y=rand(hc);var found=true;for(var i=0;i<5&&a[x][y]!=null;i++){x=rand(wc);y=rand(hc)}if(a[x][y]!=null){found=false;for(var i=0;i<wc&&!found;i++){for(var j=0;j<hc&&!found;j++){if(a[i][j]==null){x=i;y=j;found=true}}}}if(found){var startTick=-1;var ani=anim.add(g,function(e,tick){if(startTick==-1)startTick=tick;if(tick-startTick>aLength){a[x][y]=root.call(widgets.cell(g,x,y,2*rand(2)+2));anim.del(ani)}})}return found};g.moveLeft=function(){var moved=false;if(anim.count()>0)return false;for(var y=0;y<hc;y++){var pos=0;for(var x=0;x<wc;x++){if(a[x][y]!=null&&x!=pos){if(a[pos][y]!=null&&a[pos][y].value()==a[x][y].value()){a[pos][y].merge(a[x][y]);pos++;a[x][y]=null;moved=true}else if(a[pos][y]!=null){pos++;if(pos!=x){a[pos][y]=a[x][y].pos(pos,y);a[x][y]=null;moved=true}}else{a[pos][y]=a[x][y].pos(pos,y);a[x][y]=null;moved=true}}}}return moved};g.moveRight=function(){var moved=false;if(anim.count()>0)return false;for(var y=0;y<hc;y++){var pos=wc-1;for(var x=pos;x>=0;x--){if(a[x][y]!=null&&x!=pos){if(a[pos][y]!=null&&a[pos][y].value()==a[x][y].value()){a[pos][y].merge(a[x][y]);pos--;a[x][y]=null;moved=true}else if(a[pos][y]!=null){pos--;if(pos!=x){a[pos][y]=a[x][y].pos(pos,y);a[x][y]=null;moved=true}}else{a[pos][y]=a[x][y].pos(pos,y);a[x][y]=null;moved=true}}}}return moved};g.moveUp=function(){var moved=false;if(anim.count()>0)return false;for(var x=0;x<wc;x++){var pos=0;for(var y=0;y<hc;y++){if(a[x][y]!=null&&y!=pos){if(a[x][pos]!=null&&a[x][pos].value()==a[x][y].value()){a[x][pos].merge(a[x][y]);pos++;a[x][y]=null;moved=true}else if(a[x][pos]!=null){pos++;if(pos!=y){a[x][pos]=a[x][y].pos(x,pos);a[x][y]=null;moved=true}}else{a[x][pos]=a[x][y].pos(x,pos);a[x][y]=null;moved=true}}}}return moved};g.moveDown=function(){var moved=false;if(anim.count()>0)return false;for(var x=0;x<wc;x++){var pos=hc-1;for(var y=pos;y>=0;y--){if(a[x][y]!=null&&y!=pos){if(a[x][pos]!=null&&a[x][pos].value()==a[x][y].value()){a[x][pos].merge(a[x][y]);pos--;a[x][y]=null;moved=true}else if(a[x][pos]!=null){pos--;if(pos!=y){a[x][pos]=a[x][y].pos(x,pos);a[x][y]=null;moved=true}}else{a[x][pos]=a[x][y].pos(x,pos);a[x][y]=null;moved=true}}}}return moved};doc.node.onkeyup=function(e){var moved=false;if(anim.count()>0)return;switch(e.key){case"ArrowLeft":moved=g.moveLeft();break;case"ArrowRight":moved=g.moveRight();break;case"ArrowUp":moved=g.moveUp();break;case"ArrowDown":moved=g.moveDown();break}if(moved){if(!g.addCell()){console.log("You loose")}}};var pos;var pDown=function(e){pos=e;e.preventDefault()};var pUp=function(e){e.preventDefault();var moved=false;var dx=pos.clientX-e.clientX;var dy=pos.clientY-e.clientY;if(Math.abs(dx)>Math.abs(dy)&&Math.abs(dx)>20){if(dx>0)moved=g.moveLeft();else moved=g.moveRight()}else if(Math.abs(dx)<Math.abs(dy)&&Math.abs(dy)>20){if(dy>0)moved=g.moveUp();else moved=g.moveDown()}if(moved){if(!g.addCell()){console.log("You loose")}}};doc.node.onmousedown=pDown;doc.node.onmouseup=pUp;doc.node.addEventListener("touchstart",pDown,false);doc.node.addEventListener("touchmove",function(e){e.preventDefault()},false);doc.node.addEventListener("touchend",pUp,false);return g};return cons}});(function(global,factory){factory(global.game,global.game.widgets,global.game.sprites,global.game.text,global.game.anim,global.game.screens,global.doc,global)})(this,function(game,widgets,sprites,text,anim,screens,doc,global){screens.add("2048",function(screen){text.setDefaultFamily("Special Elite, cursive");var svg=this.add("svg").attr("viewBox","0 0 1920 1080");var sw=4,sh=4;var grid=svg.call(widgets.grid(sw,sh));grid.addCell()}).play("2048")});
  </script>
 </body>
</html>
